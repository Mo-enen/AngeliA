using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using PixelJelly;

namespace PixelJelly {
	public class ItemPile : JellyBehaviour {




		// VAR
		public override string DisplayName => "Pile of Items";
		public override string DisplayGroup => "Environment";
		public override int MaxFrameCount => 1;
		public override int MaxSpriteCount => 64;
		public LightDirection2 LightingDirection { get => m_LightDirection; set => m_LightDirection = value; }
		public Vector2Int LayerCount { get => m_LayerCount; set => m_LayerCount = value; }
		public Vector2Int LayerHeight { get => m_LayerHeight; set => m_LayerHeight = value; }
		public Vector2Int ItemTop { get => m_ItemTop; set => m_ItemTop = value; }
		public Vector2Int ItemBottom { get => m_ItemBottom; set => m_ItemBottom = value; }
		public Color32 Light { get => m_Light; set => m_Light = value; }
		public Color32 Dark { get => m_Dark; set => m_Dark = value; }
		public PixelSprite[] Items { get => m_Items; set => m_Items = value; }

		// Ser
		[SerializeField, ArrowNumber(true)] LightDirection2 m_LightDirection = LightDirection2.Right;
		[SerializeField, MinMaxNumber(1, 128)] Vector2Int m_LayerCount = new Vector2Int(1, 3);
		[SerializeField, MinMaxNumber(1)] Vector2Int m_LayerHeight = new Vector2Int(6, 8);
		[SerializeField, MinMaxNumber(1)] Vector2Int m_ItemTop = new Vector2Int(2, 3);
		[SerializeField, MinMaxNumber(1)] Vector2Int m_ItemBottom = new Vector2Int(3, 5);
		[SerializeField] Color32 m_Light = new Color32(255, 255, 255, 255);
		[SerializeField] Color32 m_Dark = new Color32(126, 123, 145, 255);
		[SerializeField, PixelEditor] PixelSprite[] m_Items = new PixelSprite[0];


		// MSG
		protected override void OnCreated () {
			Width = 32;
			Height = 32;
			FrameCount = 1;
			SpriteCount = 15;
			m_Items = GetDefaultItems();
		}


		protected override void OnPopulatePixels (int width, int height, int frame, int frameCount, int sprite, int spriteCount, out Vector2 pivot, out RectOffset border) {
			pivot = new Vector2(width / 2f, 0);
			border = new RectOffset(0, 0, 0, 0);
			if (m_Items == null || m_Items.Length == 0) { return; }
			bool flip = m_LightDirection == LightDirection2.Left;
			var rect = new RectInt(0, 0, width, height);
			int layerCount = m_LayerCount.RandomBetween(Random);
			Layout_Pile(
				rect,
				m_ItemTop.RandomBetween(Random),
				m_ItemBottom.RandomBetween(Random),
				layerCount,
				m_LayerHeight.RandomBetween(Random),
				true,
				(pos, layer) => {
					var item = m_Items[Random.Next(0, m_Items.Length)];
					if (item == null || item.Width == 0 || item.Height == 0) { return (default, false); }
					var realRect = new RectInt(pos.x, pos.y, item.Width, item.Height);
					if (realRect.x < rect.x || realRect.xMax > rect.xMax || realRect.y < rect.y || realRect.yMax > rect.yMax) { return (realRect, false); }
					DrawSprite(realRect, item, layerCount <= 1 ? m_Light : Color32.Lerp(m_Light, m_Dark, layer / (layerCount - 1f)), SpriteScaleMode.Slice, BlendMode.OneMinusAlpha, false, flip);
					return (realRect, true);
				}
			);
		}


		private PixelSprite[] GetDefaultItems () => new PixelSprite[] {
			new PixelSprite("10_11_4_0_0_0_0_0_0_0_1933588479_1933588479_1933588479_1933588479_1933588479_1933588479_0_0_0_1933588479_3213188351_2354464511_3213188351_3904401407_2354464511_3213188351_1933588479_0_2323742719_3098322943_4041661183_4041661183_4041661183_4041661183_4041661183_4041661183_3098322943_2323742719_1933588479_3213188351_3904401407_2354464511_3213188351_3904401407_2354464511_3213188351_3904401407_1933588479_1933588479_3213188351_3904401407_2354464511_3213188351_3904401407_2354464511_3213188351_3904401407_1933588479_1933588479_3213188351_3904401407_2354464511_3213188351_3904401407_2354464511_3213188351_3904401407_1933588479_1933588479_3213188351_3904401407_2354464511_3213188351_3904401407_2354464511_3213188351_3904401407_1933588479_1933588479_2354464511_3904401407_2354464511_2354464511_3904401407_2354464511_2354464511_3904401407_1933588479_2323742719_3098322943_4041661183_4041661183_4041661183_4041661183_4041661183_4041661183_3098322943_2323742719_0_1933588479_3213188351_2354464511_3213188351_3904401407_2354464511_3213188351_1933588479_0_0_0_1933588479_1933588479_1933588479_1933588479_1933588479_1933588479_0_0_"),
			new PixelSprite("15_16_7_0_0_0_0_0_0_0_1933588479_1933588479_1933588479_1933588479_1933588479_1933588479_1933588479_1933588479_1933588479_1933588479_1933588479_0_0_0_1933588479_1933588479_2354464511_3213188351_3213188351_3904401407_2354464511_3213188351_3213188351_3904401407_2354464511_1933588479_1933588479_0_0_1933588479_3904401407_2354464511_3213188351_2354464511_3904401407_2354464511_3213188351_2354464511_3904401407_2354464511_3213188351_1933588479_0_2323742719_3098322943_3098322943_4041661183_3098322943_4041661183_4041661183_4041661183_4041661183_4041661183_4041661183_4041661183_3098322943_3098322943_2323742719_2323742719_3098322943_3098322943_4041661183_4041661183_4041661183_4041661183_4041661183_3098322943_4041661183_4041661183_3098322943_3098322943_3098322943_2323742719_1933588479_3213188351_3904401407_2354464511_3213188351_3213188351_3904401407_2354464511_3213188351_3213188351_3904401407_2354464511_3213188351_3904401407_1933588479_1933588479_3213188351_3904401407_2354464511_3213188351_3213188351_3904401407_2354464511_3213188351_3213188351_3904401407_2354464511_3213188351_3904401407_1933588479_1933588479_3213188351_3904401407_2354464511_3213188351_3213188351_3904401407_2354464511_3213188351_3213188351_3904401407_2354464511_3213188351_3904401407_1933588479_1933588479_3213188351_3904401407_2354464511_3213188351_3213188351_3904401407_2354464511_3213188351_3213188351_3904401407_2354464511_3213188351_3904401407_1933588479_1933588479_3213188351_3904401407_2354464511_3213188351_3213188351_3904401407_2354464511_3213188351_3213188351_3904401407_2354464511_3213188351_3904401407_1933588479_1933588479_3213188351_3904401407_2354464511_3213188351_3213188351_3904401407_2354464511_3213188351_3213188351_3904401407_2354464511_3213188351_3904401407_1933588479_2323742719_3098322943_3098322943_3098322943_4041661183_4041661183_4041661183_4041661183_4041661183_4041661183_4041661183_3098322943_3098322943_3098322943_2323742719_2323742719_3098322943_3098322943_4041661183_4041661183_4041661183_4041661183_4041661183_4041661183_4041661183_3098322943_4041661183_3098322943_3098322943_2323742719_0_1933588479_3904401407_2354464511_3213188351_2354464511_3904401407_2354464511_3213188351_2354464511_3904401407_2354464511_3213188351_1933588479_0_0_1933588479_1933588479_2354464511_3213188351_3213188351_3904401407_2354464511_3213188351_3213188351_3904401407_2354464511_1933588479_1933588479_0_0_0_1933588479_1933588479_1933588479_1933588479_1933588479_1933588479_1933588479_1933588479_1933588479_1933588479_1933588479_0_0_"),
			new PixelSprite("16_16_8_0_0_0_0_0_2354464511_2354464511_2354464511_2354464511_2354464511_2354464511_2354464511_2354464511_2354464511_2354464511_2354464511_2354464511_2354464511_2354464511_2354464511_3213188351_2354464511_3213188351_3213188351_3213188351_3213188351_3213188351_3213188351_3213188351_3213188351_3213188351_3213188351_3213188351_3213188351_3213188351_3213188351_3904401407_2354464511_3213188351_2354464511_3213188351_3213188351_3213188351_3213188351_3904401407_3213188351_3213188351_3213188351_3904401407_3213188351_3904401407_3904401407_3904401407_3213188351_3904401407_3904401407_3904401407_3904401407_3904401407_3904401407_3904401407_3904401407_3904401407_3904401407_3904401407_3904401407_3904401407_3904401407_3904401407_2354464511_2354464511_2354464511_3213188351_1933588479_1933588479_1933588479_1933588479_2354464511_2354464511_2354464511_3213188351_2354464511_2354464511_2354464511_3213188351_2354464511_3213188351_3213188351_3904401407_1933588479_1933588479_1933588479_2354464511_2354464511_3213188351_3213188351_3904401407_2354464511_3213188351_3213188351_3904401407_2354464511_2354464511_3213188351_3904401407_1933588479_1933588479_2354464511_2354464511_3213188351_3213188351_2354464511_3904401407_2354464511_2354464511_3213188351_3904401407_2354464511_3213188351_3213188351_3904401407_1933588479_2354464511_2354464511_3213188351_3213188351_3213188351_3904401407_3904401407_2354464511_3213188351_3213188351_3904401407_2354464511_3213188351_3213188351_3904401407_2354464511_2354464511_3213188351_3213188351_3213188351_3904401407_3904401407_1933588479_2354464511_3213188351_3904401407_3904401407_2354464511_3213188351_3904401407_3904401407_2354464511_3213188351_3213188351_3213188351_3904401407_3904401407_1933588479_1933588479_2354464511_3213188351_3213188351_3904401407_2354464511_3213188351_3904401407_3904401407_2354464511_3213188351_2354464511_3904401407_3904401407_1933588479_1933588479_1933588479_2354464511_3213188351_3904401407_3904401407_3213188351_3904401407_3904401407_3904401407_3213188351_3904401407_3904401407_3904401407_1933588479_1933588479_1933588479_1933588479_3213188351_3904401407_3904401407_3904401407_2354464511_2354464511_2354464511_2354464511_2354464511_2354464511_2354464511_2354464511_2354464511_2354464511_2354464511_2354464511_2354464511_2354464511_2354464511_3213188351_2354464511_3213188351_3213188351_3213188351_3213188351_3213188351_3213188351_3213188351_3213188351_3213188351_3213188351_3213188351_3213188351_3213188351_3213188351_3904401407_2354464511_3213188351_2354464511_3213188351_3213188351_3213188351_3213188351_3904401407_3213188351_3213188351_3904401407_3904401407_3904401407_3213188351_3904401407_3904401407_3213188351_3904401407_3904401407_3904401407_3904401407_3904401407_3904401407_3904401407_3904401407_3904401407_3904401407_3904401407_3904401407_3904401407_3904401407_3904401407_"),
			new PixelSprite("16_16_8_0_0_0_0_0_2354464511_2354464511_2354464511_3213188351_2354464511_2354464511_2354464511_3213188351_2354464511_2354464511_2354464511_3213188351_2354464511_2354464511_2354464511_3213188351_2354464511_3213188351_3213188351_3904401407_2354464511_3213188351_3213188351_3904401407_2354464511_3213188351_3213188351_3904401407_2354464511_3213188351_3213188351_3904401407_2354464511_2354464511_3213188351_3904401407_2354464511_2354464511_3213188351_3904401407_2354464511_2354464511_3213188351_3904401407_2354464511_2354464511_3213188351_3904401407_2354464511_3213188351_3213188351_3904401407_2354464511_3213188351_3904401407_3904401407_2354464511_3213188351_3213188351_3904401407_2354464511_3213188351_3213188351_3904401407_2354464511_3213188351_3213188351_3904401407_2354464511_3213188351_3213188351_3904401407_2354464511_3213188351_3213188351_3904401407_2354464511_3213188351_3213188351_3904401407_2354464511_3213188351_3213188351_3904401407_2354464511_3213188351_3213188351_3904401407_2354464511_2354464511_3213188351_3904401407_2354464511_2354464511_3213188351_3904401407_2354464511_3213188351_3904401407_3904401407_2354464511_3213188351_3213188351_3904401407_2354464511_3213188351_3904401407_3904401407_2354464511_3213188351_3213188351_3904401407_2354464511_3213188351_3213188351_3904401407_2354464511_2354464511_3213188351_3904401407_2354464511_3213188351_3213188351_3904401407_2354464511_3213188351_3213188351_3904401407_2354464511_3213188351_3904401407_3904401407_2354464511_3213188351_3904401407_3904401407_2354464511_2354464511_3213188351_3904401407_2354464511_3213188351_3904401407_3904401407_3213188351_3904401407_3904401407_3904401407_2354464511_3213188351_3904401407_3904401407_2354464511_3213188351_3904401407_3904401407_2354464511_3213188351_3213188351_3904401407_0_0_0_0_2354464511_3213188351_3904401407_3904401407_2354464511_3213188351_3904401407_3904401407_2354464511_3213188351_3904401407_3904401407_0_0_0_0_2354464511_2354464511_3213188351_3904401407_2354464511_3213188351_3904401407_3904401407_3213188351_3904401407_3904401407_3904401407_0_0_0_0_2354464511_3213188351_3213188351_3904401407_2354464511_3213188351_3213188351_3904401407_0_0_0_0_0_0_0_0_2354464511_3213188351_3213188351_3904401407_2354464511_3213188351_3904401407_3904401407_0_0_0_0_0_0_0_0_2354464511_3213188351_3904401407_3904401407_3213188351_3904401407_3904401407_3904401407_0_0_0_0_0_0_0_0_3213188351_3904401407_3904401407_3904401407_0_0_0_0_0_0_0_0_"),

		};


	}
}
